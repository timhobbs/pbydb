<h1>Database</h1>

<h2>View table data</h2>
<p>
    Click the table name below to view the table's contents.
</p>

<div class="container">
    <div class="tree">
        <mat-tree [dataSource]="dbTables$" [treeControl]="treeControl">
            <mat-tree-node *matTreeNodeDef="let table">
                <button mat-button (click)="getData(table.name)">{{table.name}}</button>
            </mat-tree-node>
        </mat-tree>
        <button *ngIf="tableData$ | async" (click)="clearData()" mat-flat-button color="warn">
            Clear Data
        </button>
    </div>

    <mat-table #table matSort
        *ngIf="tableData$ | async"
        [dataSource]="tableData$"
        class="mat-elevation-z8"
        (matSortChange)="sortData($event)"
        #tableSort="matSort">
        <ng-container *ngFor="let column of columns" [matColumnDef]="column.columnDef">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="{{column.columnDef}}">{{column.header}}</th>
            <td mat-cell *matCellDef="let row">{{column.cell(row)}}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <mat-paginator showFirstLastButtons #tablePaginator
            [pageSizeOptions]="[10, 25, 50]"
            aria-label="Select page">
        </mat-paginator>
    </mat-table>
</div>

<h2>SQL</h2>

<p>
    Use the textarea below to write any SQL statement.
    <strong class="warn">WARNING:</strong> this has no training wheels, so be careful!
</p>

<ng-container *ngIf="!(sqlResult$ | async)">
    <textarea class="sql" #sql></textarea>
    <button mat-flat-button color="primary" (click)="execSql(sql.value)">Execute SQL</button>
</ng-container>
<ng-container *ngIf="sqlResult$ | async; let result">
    <textarea class="sql">{{result|json}}</textarea>
    <button mat-flat-button color="primary" (click)="clearSql()">Clear Results</button>
</ng-container>
